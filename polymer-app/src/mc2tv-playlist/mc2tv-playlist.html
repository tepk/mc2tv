<link rel="import" href="../../bower_components/polymer/polymer.html">

<!--Firebase elements-->
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<!--Paper elements-->
<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<!--UNUSED DIRECTLY-->
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<!--UNUSED DIRECTLY-->
<!--
`mc2tv-playlist`


@demo demo/index.html 
-->

<dom-module id="mc2tv-playlist">
    <template>
        <style>
            :host {
                display: block;
                width: 100%;
                backgroud: #ffffff;
            }
            .delete-item {
                color: #880000;
                cursor: pointer;
            }

            .delete-item :hover {
                color: #0a3142;
                cursor: pointer;
            }

        </style>
        <firebase-query path="/playlist" data="{{playlistData}}"></firebase-query>

        <h2>Добавление ролика в плейлист</h2>
        <form id="form">
            <paper-input value="{{url}}" id="youtubeUrl"></paper-input>
            [[prop2]]
            <input type="submit" value="submit" style="display: none;">
        </form>
        <h2>На данный момент в плейлисте числятся: [[playlistParsed]]</h2>

       <template is="dom-repeat" items="{{playlistData}}" as="note">
            <div style="margin-right: 10px; float: left; background: #ffffff;">
                <div style="text-align: right; font-size: 1.5em;"><a class="delete-item" id="[[note.$key]]" on-tap="__deleteItem">×</a></div>
                <img src="https://img.youtube.com/vi/[[note.youtubeId]]/0.jpg">
            </div>
        </template>
    </template>

    <script>
        Polymer({

            is: 'mc2tv-playlist',
            ready: function () {
                var database = firebase.database();
            },

            properties: {
                prop1: {
                    type: String,
                    value: 'mc2tv-playlist',
                },
                url: {
                    type: String,
                    value: '',
                    notify: true,
                },
                prop2: {
                    type: String,
                    computed: '__getYoutubeId(url)',
                },

            },
            listeners: {
                'submit': '__onFormSubmit'
            },

            __getYoutubeId: function (url) {
                if (url) {
                    if (url.substr(0, 24) === "https://www.youtube.com/") {
                        return url.substr(32, 11)
                    } else {
                        return "Неверный URL"
                    }
                } else {
                    return "Введите URL ролика"
                }
            },

            __deleteItem: function(e, t) {
                e.preventDefault();
                console.log(this)
                console.log(e)
                console.log(e.target.id)
                firebase.database().ref('playlist').child(e.target.id).remove()
            },

            __onFormSubmit: function (e) {
                e.preventDefault();
                var t = new Date().getTime();
                console.log(this.$.form)
                firebase.database().ref('playlist').push({
                    youtubeId: this.$.youtubeUrl.value.substr(32, 11)
                })
                this.$.form.reset()

            }

        });
    </script>
</dom-module>

<link rel="import" href="../../bower_components/polymer/polymer.html">

<!--Firebase elements-->
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<!--Paper elements-->
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<!--UNUSED DIRECTLY-->
<!--
`mc2tv-playlist`


@demo demo/index.html 
-->

<dom-module id="mc2tv-playlist">
    <template>
        <style>
            :host {
                display: block;
                width: 70%;
                margin-left: 15%;
            }
        </style>
        <firebase-query path="/playlist" data="{{playlistData}}"></firebase-query>


        <h2>Добавление ролика в плейлист</h2>
        <form>
            <paper-input value="{{url}}" id="youtubeUrl"></paper-input>
            [[prop2]]
            <input type="submit" value="submit" style="display: none;">
        </form>
        <h2>На данный момент в плейлисте числятся: [[playlistParsed]]</h2>

        <template is="dom-repeat" items="{{playlistData}}" as="note">
            <iframe width="420" height="345" src="https://www.youtube.com/embed/[[note.youtubeId]]">
            </iframe>
        </template>
    </template>

    <script>
        Polymer({

            is: 'mc2tv-playlist',
            ready: function () {
                var database = firebase.database();
            },
            properties: {
                prop1: {
                    type: String,
                    value: 'mc2tv-playlist',
                },
                url: {
                    type: String,
                    value: '',
                    notify: true,
                },
                prop2: {
                    type: String,
                    computed: '__getYoutubeId(url)',
                },
                playlistData: {
                    type: Array,
                    notify: true
                },
                playlistParsed: {
                    type: String,
                    computed: '__getPlayListArr(playlistData)',
                    observer: '__dataReady',
                    notify: true
                }
            },
            listeners: {
                'submit': '__onFormSubmit'
            },
            __getYoutubeId: function (url) {
                if (url) {
                    if (url.substr(0, 24) === "https://www.youtube.com/") {
                        return url.slice(-11)
                    } else {
                        return "Неверный URL"
                    }
                } else {
                    return "Введите URL ролика"
                }
            },
            __getPlayListArr: function (playlistData) {
                var d = playlistData;

                    var a = "";
                    var l = d.length;
                    d.forEach(function (item, i) {
                        if (i < (l - 1)) {
                            a = a + item.youtubeId + ','
                        } else {
                            a = a + item.youtubeId
                        }
                    });
                    console.log(a);

                return a
            },
            __onFormSubmit: function (e) {
                e.preventDefault();
                var t = new Date().getTime();
                console.log(this.$.youtubeUrl.value.slice(-11));
                firebase.database().ref('playlist/' + t).set({
                    youtubeId: this.$.youtubeUrl.value.slice(-11)
                })

            }

        });
    </script>
</dom-module>
